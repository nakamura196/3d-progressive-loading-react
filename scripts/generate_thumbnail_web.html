<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GLB Thumbnail Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        h1 {
            color: #333;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        .model-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .model-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        canvas {
            width: 100%;
            height: 200px;
            border-radius: 4px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-bottom: 10px;
        }
        .download-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        .download-btn:hover {
            background: #45a049;
        }
        .status {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        #instructions {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>GLB Thumbnail Generator</h1>
    
    <div id="instructions">
        <strong>Instructions:</strong>
        <ol>
            <li>Open this file in your browser (file:// URL is fine)</li>
            <li>The thumbnails will be generated automatically for each model</li>
            <li>Click "Download Thumbnail" to save each image</li>
            <li>Save them as: modelname_thumbnail.png in the public/thumbnails folder</li>
        </ol>
    </div>

    <div class="controls">
        <label>
            Thumbnail Size: 
            <select id="size">
                <option value="256">256x256</option>
                <option value="512" selected>512x512</option>
                <option value="1024">1024x1024</option>
            </select>
        </label>
    </div>

    <div class="model-grid" id="modelGrid">
        <!-- Model cards will be inserted here -->
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
        import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';
        import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';

        // Models to generate thumbnails for
        const models = [
            {
                name: 'sponza_s',
                path: '../public/data/models/sponza/sponza_s_lod2.glb',
                label: 'Sponza Atrium'
            },
            {
                name: 'scaniverse',
                path: '../public/data/models/scaniverse/scaniverse_lod2.glb',
                label: 'Scaniverse Scan 1'
            },
            {
                name: 'scaniverse2',
                path: '../public/data/models/scaniverse2/scaniverse2_lod2.glb',
                label: 'Scaniverse Scan 2'
            }
        ];

        class ThumbnailGenerator {
            constructor(container, modelData) {
                this.container = container;
                this.modelData = modelData;
                this.size = 512;
                
                this.init();
            }

            init() {
                // Create scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0xf0f0f5);
                
                // Add lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                this.scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 5, 5);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);
                
                const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
                directionalLight2.position.set(-5, 5, -5);
                this.scene.add(directionalLight2);
                
                // Create camera
                this.camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
                
                // Create renderer
                this.renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    preserveDrawingBuffer: true
                });
                this.renderer.setSize(this.size, this.size);
                this.renderer.shadowMap.enabled = true;
                this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                // Add canvas to container
                this.canvas = this.renderer.domElement;
                this.container.appendChild(this.canvas);
                
                // Add controls (for manual adjustment if needed)
                this.controls = new OrbitControls(this.camera, this.canvas);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                
                // Load model
                this.loadModel();
            }

            loadModel() {
                const loader = new GLTFLoader();
                const statusEl = this.container.querySelector('.status');
                statusEl.textContent = 'Loading model...';
                
                loader.load(
                    this.modelData.path,
                    (gltf) => {
                        // Add model to scene
                        this.model = gltf.scene;
                        this.scene.add(this.model);
                        
                        // Center and scale model
                        const box = new THREE.Box3().setFromObject(this.model);
                        const center = box.getCenter(new THREE.Vector3());
                        const size = box.getSize(new THREE.Vector3());
                        
                        // Center the model
                        this.model.position.x = -center.x;
                        this.model.position.y = -center.y;
                        this.model.position.z = -center.z;
                        
                        // Calculate camera position
                        const maxDim = Math.max(size.x, size.y, size.z);
                        const fov = this.camera.fov * (Math.PI / 180);
                        let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                        cameraZ *= 1.5; // Add some padding
                        
                        this.camera.position.set(cameraZ * 0.7, cameraZ * 0.5, cameraZ * 0.7);
                        this.camera.lookAt(0, 0, 0);
                        
                        // Update controls target
                        this.controls.target.set(0, 0, 0);
                        this.controls.update();
                        
                        // Render
                        this.animate();
                        statusEl.textContent = 'Model loaded! You can rotate to adjust the view.';
                        
                        // Auto-generate after a short delay
                        setTimeout(() => {
                            this.generateThumbnail();
                        }, 1000);
                    },
                    (progress) => {
                        const percent = (progress.loaded / progress.total * 100).toFixed(0);
                        statusEl.textContent = `Loading: ${percent}%`;
                    },
                    (error) => {
                        console.error('Error loading model:', error);
                        statusEl.textContent = 'Error loading model!';
                    }
                );
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                this.controls.update();
                this.renderer.render(this.scene, this.camera);
            }

            generateThumbnail() {
                // Render one more frame to ensure it's up to date
                this.renderer.render(this.scene, this.camera);
                
                // Get canvas data
                const dataURL = this.canvas.toDataURL('image/png');
                
                // Update download button
                const downloadBtn = this.container.querySelector('.download-btn');
                downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.download = `${this.modelData.name}_thumbnail.png`;
                    link.href = dataURL;
                    link.click();
                };
                
                const statusEl = this.container.querySelector('.status');
                statusEl.textContent = 'Thumbnail ready! Click download to save.';
            }

            updateSize(newSize) {
                this.size = newSize;
                this.renderer.setSize(this.size, this.size);
                this.generateThumbnail();
            }
        }

        // Create UI for each model
        const modelGrid = document.getElementById('modelGrid');
        const generators = [];

        models.forEach(modelData => {
            const card = document.createElement('div');
            card.className = 'model-card';
            card.innerHTML = `
                <h3>${modelData.label}</h3>
                <div class="canvas-container"></div>
                <button class="download-btn">Download Thumbnail</button>
                <div class="status">Initializing...</div>
            `;
            modelGrid.appendChild(card);
            
            const container = card.querySelector('.canvas-container');
            const generator = new ThumbnailGenerator(container, modelData);
            generators.push(generator);
        });

        // Handle size change
        document.getElementById('size').addEventListener('change', (e) => {
            const newSize = parseInt(e.target.value);
            generators.forEach(gen => gen.updateSize(newSize));
        });
    </script>
</body>
</html>